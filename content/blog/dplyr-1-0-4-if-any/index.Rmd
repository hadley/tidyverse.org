---
output: hugodown::md_document

slug: dplyr-1-0-4-if-any
title: "dplyr 1.0.4: `if_any()` and `if_all()`"
date: 2021-02-01
author: Romain Francois
description: >
    Minor release with major performance improvements for `across()` and 
    two new functions `if_any()` and `if_all()`.

photo:
  url: https://unsplash.com/photos/nQz49efZEFs
  author: Mattias Olsson

categories: [package] 
tags: [dplyr]
---

We're happy to announce the release of [dplyr](https://dplyr.tidyverse.org) 1.0.4. dplyr is the data
manipulation package of the [tidyverse](https://www.tidyverse.org). 

This blog post will discuss the highlights of dplyr 1.0.4, which 
introduces the new functions `if_all()` and `if_any()` 
as companions to `filter()`, and dramatically improves the performance 
of `across()`. You can see a full list of changes in the [release notes]({ github_release })

You can install it from CRAN with:

```{r, eval = FALSE}
install.packages("dplyr")
```

```{r setup}
library(dplyr, warn.conflicts = FALSE)
```

## if_any() and if_all()

The new `across()` function introduced as part of dplyr 1.0.0 is proving to be 
a successful addition to dplyr. In case you missed it, `across()` lets you 
conveniently express a set of actions to be performed across a tidy selection 
of columns. 

However useful `across()` may be within `summarise()` and `mutate()`, we discovered
that it is not optimal in the context of `filter()`, and is not sufficient in itself 
to replace the set of column wise `filter()` variant it meant to supersede. 

To fill the gap, we're introducing the two functions `if_all()` and `if_any()`. Let's 
directly dive in to an example: 

```{r}
library(palmerpenguins)

big <- function(x) {
  x > mean(x, na.rm = TRUE)
}

penguins %>% 
  filter(if_all(contains("bill"), big))

penguins %>% 
  filter(if_any(contains("bill"), big))
```

Both functions operate similarly to `across()` but go the extra mile of aggregating the 
results to indicate if *all* the results are true when using `if_all()`, or if *at least 
one* is true when using `if_any()`. 

Although `if_all()` and `if_any()` were designed with `filter()` in mind, we 
[then discovered](https://github.com/tidyverse/dplyr/issues/5709) that they can also be
useful within `mutate()` and/or `summarise()`. 

```{r}
penguins %>% 
  filter(!is.na(bill_length_mm)) %>% 
  mutate(
    category = case_when(
      if_all(contains("bill"), big) ~ "both big", 
      if_any(contains("bill"), big) ~ "one big", 
      TRUE                          ~ "small"
    )) %>% 
  count(category)
```

## Faster across()

One net benefit of `across()` is that it supersedes a collection of functions, 
namely the column wise set of functions (`summarise_at()` ...). However, up until the 
previous release, this came with a cost in terms of performance. 

In the 1.0.4 release, we have redesigned `across()` to perform better by doing less
when possible. With these improvements, using `across()` within `summarise()` or `mutate()`
has the same performance as the relevant column wise version. 

```{r}
library(vroom)

mun2014 <- vroom("https://data.regardscitoyens.org/elections/2014_municipales/MN14_Bvot_T1_01-49.txt", 
                 col_select = -c('X4','X9','X10','X11'),
                 col_names = FALSE, 
                 locale = locale(encoding = "WINDOWS-1252"), altrep = FALSE) 
bench::workout({
  a <- mun2014 %>% group_by_if( is.character )
  b <- a %>% summarise_if( is.numeric, sum ) 
})

bench::workout({
  c <- mun2014 %>% group_by( across(where(is.character)))
  d <- c %>% summarise( across(where(is.numeric), sum) ) 
})
```


## Acknowledgements

Merci to all contributors of code, issues and documentation to this release:

[&#x0040;abalter](https://github.com/abalter), [&#x0040;cuixueqin](https://github.com/cuixueqin), [&#x0040;eggrandio](https://github.com/eggrandio), [&#x0040;everetr](https://github.com/everetr), [&#x0040;hadley](https://github.com/hadley), [&#x0040;hjohns12](https://github.com/hjohns12), [&#x0040;iago-pssjd](https://github.com/iago-pssjd), [&#x0040;jahonamir](https://github.com/jahonamir), [&#x0040;krlmlr](https://github.com/krlmlr), [&#x0040;lionel-](https://github.com/lionel-), [&#x0040;lotard](https://github.com/lotard), [&#x0040;luispfonseca](https://github.com/luispfonseca), [&#x0040;mbcann01](https://github.com/mbcann01), [&#x0040;mutahiwachira](https://github.com/mutahiwachira), [&#x0040;Robinlovelace](https://github.com/Robinlovelace), [&#x0040;romainfrancois](https://github.com/romainfrancois), [&#x0040;rpruim](https://github.com/rpruim), [&#x0040;shahronak47](https://github.com/shahronak47), [&#x0040;shangguandong1996](https://github.com/shangguandong1996), [&#x0040;sylvainDaubree](https://github.com/sylvainDaubree), [&#x0040;tomazweiss](https://github.com/tomazweiss), [&#x0040;vhorvath](https://github.com/vhorvath), [&#x0040;wasdoff](https://github.com/wasdoff), and [&#x0040;Yunuuuu](https://github.com/Yunuuuu).
