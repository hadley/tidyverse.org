---
title: 
date: 
author: 
description: >
    tidyr 1.1.0 includes a bunch of quality of life improvements, particularly
    to pivoting and rectangling.

photo:
  url: https://unsplash.com/photos/__ZMnefoI3k
  author: Jan Vasek

# one of: "deep-dive", "learn", "package", "programming", or "other"
categories: [package] 
tags: [tidyr]
---

<!--
TODO:
* [ ] Pick category and tags (see existing with `post_tags()`)
* [ ] Find photo & update yaml metadata
* [ ] Create 300 x 300 `thumb-sq.png`
* [ ] Create 200 x >1000 `thumb-wd.png`
* [ ] `use_tidy_thanks()`
-->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, 
  comment = "#>", 
  fig.width = 7, 
  fig.align = "center",
  fig.asp = 0.618, # 1 / phi
  out.width = "700px"
)
```

This release doesn't include any major new excitement but it includes a whole passel of minor improvements building on the major changes in tidyr 1.1.0, and generally making everything easier to use and a little more flexible.

In this blog post, I'll focus on the improvements to pivoting and rectangling; see the full release announcement for details of other improvements.

```{r setup}
library(tidyr)
```

## Pivotting improvements

Finally, thanks to [Davis Vaughn](http://github.com/DavisVaughan) both `pivot_wider()` and `pivot_longer()` are considerably more performant, thanks largely to improvements in the underlying vctrs code.

### `pivot_longer()`

* `pivot_longer()`, `hoist()`, `unnest_wider()`, and `unnest_longer()` gain
  new `transform` arguments; these allow you to transform values "in flight". 
  They are partly needed because vctrs coercion rules have become stricter,
  but they give you greater flexibility than was available previously (#921).

*   Thanks to idea and implementation from 
    [Mitch O'Hara Wild](https://github.com/mitchelloharawild), `pivot_longer()` 
    can now discard uninformative column names by setting 
    `names_to = character()`:

    ```{r}
    df <- tibble(id = 1:3, fruitful_panda = 1:3, angry_aardvark = 4:6)  
    df %>% pivot_longer(-id, names_to = character())
    ```
* `pivot_longer()` no longer creates a `.copy` variable in the presence of
  duplicate column names. This makes it more consistent with the handling
  of non-unique specs.
  
    ```{r}
    df <- tibble(id = 1:3, x = 1:3, x = 4:6, .name_repair = "minimal")  
    df %>% pivot_longer(-id)
    ```
*   `pivot_longer()` automatically disambiguates non-unique ouputs, which can
    occur when the input variables include some additional component that you
    don't care about and want to discard. You can discard parts of column names
    either with `names_pattern` or with `NA` in `names_to`.
  
    ```{r}
    df <- tibble(id = 1:3, x_1 = 1:3, y_2 = 4:6, y_3 = 9:11)  
    df %>% pivot_longer(-id, names_pattern = "(.)_.")
    df %>% pivot_longer(-id, names_sep = "_", names_to = c("name", NA))
    df %>% pivot_longer(-id, names_sep = "_", names_to = c(".value", NA))
    ```
### `pivot_wider()`

*   `pivot_wider()` gains a `names_sort` argument which allows you to sort
    column names in order. The default, `FALSE`, orders columns by their 
    first appearance. In a future version, I'll consider changing the default 
    to `TRUE`.
    
    ```{r}
    df <- tibble(
      day_int = c(4, 3, 5, 1, 2),
      day_fac = factor(day_int, labels = c("Mon", "Tue", "Wed", "Thu", "Fri"))
    )
    df %>% pivot_wider(
      names_from = day_fac, 
      values_from = day_int
    )
    df %>% pivot_wider(
      names_from = day_fac,
      names_sort = TRUE,
      values_from = day_int
    )
    ```
    
*   `pivot_wider()` gains a `names_glue` argument that allows you to construct
    output column names with a glue specification when `names_to` includes 
    multiple columns.
    
```{r}

```

*   `pivot_wider()` arguments `values_fn` and `values_fill` can now be single 
    values; you now only need to use a named list if you want to use different 
    values for different value columns. They also get improved errors if 
    they're not of the expected type.
    
    

## Rectangling

* `hoist()` now automatically names pluckers that are a single string (#837).
  It error if you use duplicated column names (@mgirlich, #834), and now uses 
  `rlang::list2()` behind the scenes (which means that you can now use `!!!` 
  and `:=`) (#801).

* `unnest_longer()`, `unnest_wider()`, and `hoist()` do a better job 
  simplifying list-cols. They no longer add unneeded `unspecified()` when
  the result is still a list (#806), and work when the list contains 
  non-vectors (#810, #848).

* `unnest_wider(names_sep = "")` now provides default names for unnamed inputs,
  suppressing the many previous name repair messages (#742).

## Acknowledgements

